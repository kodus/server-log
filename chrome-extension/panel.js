import { renderLog } from "./log.js";
/**
 * This custom element allows us to isolate server-side log pages in a shadow-root.
 */
class LogEntry extends HTMLElement {
    constructor() {
        super();
        this.shadow = this.attachShadow({ mode: "open" });
    }
    setHTML(html) {
        let doc = new DOMParser().parseFromString(html, "text/html");
        this.style.display = "block";
        [...doc.head.querySelectorAll("style")].forEach(style => this.shadow.appendChild(style));
        [...doc.body.childNodes].forEach(node => this.shadow.appendChild(node));
    }
}
customElements.define("log-entry", LogEntry);
((panel) => {
    console.log("START: panel.js");
    const $content = document.body.querySelector("[data-content]");
    panel.onNavigation = url => {
        console.log("ON NAVIGATION", url);
        // TODO add "Preserve Log" option (similar to the "Network" tab)
        $content.innerHTML = "";
    };
    panel.onRequest = transaction => {
        console.log("ON REQUEST", transaction);
        // NOTE: weird typecasts required here because the request/response properties
        //       aren't defined in `@types/chrome` - we have to pull these definitions
        //       from a separate package `@types/har-format` and manually cast:
        const request = transaction.request;
        const response = transaction.response;
        const title = `${request.method} ${request.url} [${response.status} ${response.statusText}]`;
        for (let header of response.headers) {
            const name = header.name.toLowerCase();
            if (name === "x-chromelogger-data") {
                appendLog(title, "X-ChromeLogger-Data", new Promise((resolve, reject) => {
                    try {
                        const log = JSON.parse(atob(header.value));
                        console.log("PARSED CHROME-LOGGER HEADER", log);
                        resolve(renderLog(log));
                    }
                    catch (error) {
                        reject(`Error parsing X-ChromeLogger-Data header (${error})`);
                    }
                }));
            }
        }
    };
    /**
     * Append a log document to the "Server Log" panel
     */
    function appendLog(title, source, documentPromise) {
        const header = appendHeader("spinner", title, source);
        const el = document.createElement("log-entry");
        $content.appendChild(el);
        documentPromise
            .then(html => {
            el.setHTML(html);
            header.setIcon("check");
        })
            .catch(error => {
            el.setHTML(`<pre style="color:red; padding-left:20px;">${html(error)}</pre>`);
            header.setIcon("error");
        });
    }
    /**
     * Create a header with an icon, title and source of the request
     */
    function appendHeader(icon, title, source) {
        const el = document.createElement("div");
        el.innerHTML = (`
            <div class="header ${icon ? `header--${icon}` : ``}">
                <div class="header__icon">${icon ? `<span class="icon"></span>` : ``}</div>
                <div class="header__title">${html(title)}</div>
                <div class="header__source">${html(source)}</div>
            </div>`);
        $content.appendChild(el);
        function setIcon(icon) {
            el.querySelector(".icon").className = `icon icon-${icon}`;
        }
        ;
        setIcon(icon);
        return {
            setIcon
        };
    }
    /**
     * Escape plain text as HTML
     */
    function html(str) {
        return (str || '')
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
    }
})(window);
/*

// NOTE: don't need this for now - might need it to communicate with "background.js"

panel_window.do_something = (msg: string) => {
    console.log("DOING SOMETHING");
    document.body.textContent += '\n' + msg; // Stupid example, PoC
}

document.documentElement.onclick = function() {
    // No need to check for the existence of `respond`, because
    // the panel can only be clicked when it's visible...
    panel_window.respond('Another stupid example!');
};
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcGFuZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBTyxNQUFNLFVBQVUsQ0FBQztBQUsxQzs7R0FFRztBQUNILE1BQU0sUUFBUyxTQUFRLFdBQVc7SUFHOUI7UUFDSSxLQUFLLEVBQUUsQ0FBQztRQUVSLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxPQUFPLENBQUMsSUFBWTtRQUNoQixJQUFJLEdBQUcsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFN0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRTdCLENBQUMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUMzQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFN0MsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUM1QixJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUNKO0FBRUQsY0FBYyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFFN0MsQ0FBQyxDQUFDLEtBQWtCLEVBQUUsRUFBRTtJQUVwQixPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFFL0IsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQWMsZ0JBQWdCLENBQUUsQ0FBQztJQUU3RSxLQUFLLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxFQUFFO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRWxDLGdFQUFnRTtRQUNoRSxRQUFRLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUM1QixDQUFDLENBQUM7SUFFRixLQUFLLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxFQUFFO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBRXZDLDhFQUE4RTtRQUM5RSw4RUFBOEU7UUFDOUUsdUVBQXVFO1FBRXZFLE1BQU0sT0FBTyxHQUFJLFdBQW1CLENBQUMsT0FBa0IsQ0FBQztRQUN4RCxNQUFNLFFBQVEsR0FBSSxXQUFtQixDQUFDLFFBQW9CLENBQUM7UUFFM0QsTUFBTSxLQUFLLEdBQUcsR0FBRyxPQUFPLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxHQUFHLEtBQUssUUFBUSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsVUFBVSxHQUFHLENBQUM7UUFFN0YsS0FBSyxJQUFJLE1BQU0sSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFO1lBQ2pDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFFdkMsSUFBSSxJQUFJLEtBQUsscUJBQXFCLEVBQUU7Z0JBQ2hDLFNBQVMsQ0FBQyxLQUFLLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7b0JBQ3BFLElBQUk7d0JBQ0EsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7d0JBRTNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxDQUFDLENBQUM7d0JBRWhELE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBVSxDQUFDLENBQUMsQ0FBQztxQkFDbEM7b0JBQUMsT0FBTyxLQUFLLEVBQUU7d0JBQ1osTUFBTSxDQUFDLDZDQUE2QyxLQUFLLEdBQUcsQ0FBQyxDQUFDO3FCQUNqRTtnQkFDTCxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ1A7U0FDSjtJQUNMLENBQUMsQ0FBQTtJQUVEOztPQUVHO0lBQ0gsU0FBUyxTQUFTLENBQUMsS0FBYSxFQUFFLE1BQWMsRUFBRSxlQUFnQztRQUM5RSxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUV0RCxNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBYSxDQUFDO1FBRTNELFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFekIsZUFBZTthQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNULEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFakIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUM7YUFDRCxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDWCxFQUFFLENBQUMsT0FBTyxDQUFDLDhDQUE4QyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTlFLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTLFlBQVksQ0FBQyxJQUFVLEVBQUUsS0FBYSxFQUFFLE1BQWM7UUFDM0QsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV6QyxFQUFFLENBQUMsU0FBUyxHQUFHLENBQUM7aUNBQ1MsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFOzRDQUUxQyxJQUFJLENBQUMsQ0FBQyxDQUFDLDRCQUE0QixDQUFDLENBQUMsQ0FBQyxFQUMxQzs2Q0FDNkIsSUFBSSxDQUFDLEtBQUssQ0FBQzs4Q0FDVixJQUFJLENBQUMsTUFBTSxDQUFDO21CQUN2QyxDQUNWLENBQUM7UUFFRixRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXpCLFNBQVMsT0FBTyxDQUFDLElBQVU7WUFDdkIsRUFBRSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUUsQ0FBQyxTQUFTLEdBQUcsYUFBYSxJQUFJLEVBQUUsQ0FBQztRQUMvRCxDQUFDO1FBQUEsQ0FBQztRQUVGLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVkLE9BQU87WUFDSCxPQUFPO1NBQ1YsQ0FBQztJQUNOLENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsSUFBSSxDQUFDLEdBQThCO1FBQ3hDLE9BQU8sQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDO2FBQ2IsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUM7YUFDdEIsT0FBTyxDQUFDLElBQUksRUFBRSxRQUFRLENBQUM7YUFDdkIsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUM7YUFDdEIsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUM7YUFDckIsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMvQixDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMsTUFBcUIsQ0FBQyxDQUFDO0FBRTFCOzs7Ozs7Ozs7Ozs7OztFQWNFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVuZGVyTG9nLCBMb2cgfSBmcm9tIFwiLi9sb2cuanNcIjtcclxuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiaGFyLWZvcm1hdFwiO1xyXG5cclxudHlwZSBJY29uID0gXCJzcGlubmVyXCIgfCBcImVycm9yXCIgfCBcImNoZWNrXCIgfCB1bmRlZmluZWQ7XHJcblxyXG4vKipcclxuICogVGhpcyBjdXN0b20gZWxlbWVudCBhbGxvd3MgdXMgdG8gaXNvbGF0ZSBzZXJ2ZXItc2lkZSBsb2cgcGFnZXMgaW4gYSBzaGFkb3ctcm9vdC5cclxuICovXHJcbmNsYXNzIExvZ0VudHJ5IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xyXG4gICAgcHJpdmF0ZSBzaGFkb3c6IFNoYWRvd1Jvb3Q7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy5zaGFkb3cgPSB0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6IFwib3BlblwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEhUTUwoaHRtbDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgXCJ0ZXh0L2h0bWxcIik7XHJcblxyXG4gICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuXHJcbiAgICAgICAgWy4uLmRvYy5oZWFkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzdHlsZVwiKV0uZm9yRWFjaChcclxuICAgICAgICAgICAgc3R5bGUgPT4gdGhpcy5zaGFkb3cuYXBwZW5kQ2hpbGQoc3R5bGUpKTtcclxuXHJcbiAgICAgICAgWy4uLmRvYy5ib2R5LmNoaWxkTm9kZXNdLmZvckVhY2goXHJcbiAgICAgICAgICAgIG5vZGUgPT4gdGhpcy5zaGFkb3cuYXBwZW5kQ2hpbGQobm9kZSkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJsb2ctZW50cnlcIiwgTG9nRW50cnkpO1xyXG5cclxuKChwYW5lbDogUGFuZWxXaW5kb3cpID0+IHtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIlNUQVJUOiBwYW5lbC5qc1wiKTtcclxuXHJcbiAgICBjb25zdCAkY29udGVudCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oXCJbZGF0YS1jb250ZW50XVwiKSE7XHJcblxyXG4gICAgcGFuZWwub25OYXZpZ2F0aW9uID0gdXJsID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIk9OIE5BVklHQVRJT05cIiwgdXJsKTtcclxuXHJcbiAgICAgICAgLy8gVE9ETyBhZGQgXCJQcmVzZXJ2ZSBMb2dcIiBvcHRpb24gKHNpbWlsYXIgdG8gdGhlIFwiTmV0d29ya1wiIHRhYilcclxuICAgICAgICAkY29udGVudC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgfTtcclxuXHJcbiAgICBwYW5lbC5vblJlcXVlc3QgPSB0cmFuc2FjdGlvbiA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJPTiBSRVFVRVNUXCIsIHRyYW5zYWN0aW9uKTtcclxuXHJcbiAgICAgICAgLy8gTk9URTogd2VpcmQgdHlwZWNhc3RzIHJlcXVpcmVkIGhlcmUgYmVjYXVzZSB0aGUgcmVxdWVzdC9yZXNwb25zZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgLy8gICAgICAgYXJlbid0IGRlZmluZWQgaW4gYEB0eXBlcy9jaHJvbWVgIC0gd2UgaGF2ZSB0byBwdWxsIHRoZXNlIGRlZmluaXRpb25zXHJcbiAgICAgICAgLy8gICAgICAgZnJvbSBhIHNlcGFyYXRlIHBhY2thZ2UgYEB0eXBlcy9oYXItZm9ybWF0YCBhbmQgbWFudWFsbHkgY2FzdDpcclxuXHJcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9ICh0cmFuc2FjdGlvbiBhcyBhbnkpLnJlcXVlc3QgYXMgUmVxdWVzdDtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9ICh0cmFuc2FjdGlvbiBhcyBhbnkpLnJlc3BvbnNlIGFzIFJlc3BvbnNlO1xyXG5cclxuICAgICAgICBjb25zdCB0aXRsZSA9IGAke3JlcXVlc3QubWV0aG9kfSAke3JlcXVlc3QudXJsfSBbJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1dYDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaGVhZGVyIG9mIHJlc3BvbnNlLmhlYWRlcnMpIHtcclxuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGhlYWRlci5uYW1lLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gXCJ4LWNocm9tZWxvZ2dlci1kYXRhXCIpIHtcclxuICAgICAgICAgICAgICAgIGFwcGVuZExvZyh0aXRsZSwgXCJYLUNocm9tZUxvZ2dlci1EYXRhXCIsIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2cgPSBKU09OLnBhcnNlKGF0b2IoaGVhZGVyLnZhbHVlKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBBUlNFRCBDSFJPTUUtTE9HR0VSIEhFQURFUlwiLCBsb2cpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZW5kZXJMb2cobG9nIGFzIExvZykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChgRXJyb3IgcGFyc2luZyBYLUNocm9tZUxvZ2dlci1EYXRhIGhlYWRlciAoJHtlcnJvcn0pYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQXBwZW5kIGEgbG9nIGRvY3VtZW50IHRvIHRoZSBcIlNlcnZlciBMb2dcIiBwYW5lbFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBhcHBlbmRMb2codGl0bGU6IHN0cmluZywgc291cmNlOiBzdHJpbmcsIGRvY3VtZW50UHJvbWlzZTogUHJvbWlzZTxzdHJpbmc+KSB7XHJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gYXBwZW5kSGVhZGVyKFwic3Bpbm5lclwiLCB0aXRsZSwgc291cmNlKTtcclxuXHJcbiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibG9nLWVudHJ5XCIpIGFzIExvZ0VudHJ5O1xyXG5cclxuICAgICAgICAkY29udGVudC5hcHBlbmRDaGlsZChlbCk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50UHJvbWlzZVxyXG4gICAgICAgICAgICAudGhlbihodG1sID0+IHtcclxuICAgICAgICAgICAgICAgIGVsLnNldEhUTUwoaHRtbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaGVhZGVyLnNldEljb24oXCJjaGVja1wiKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGVsLnNldEhUTUwoYDxwcmUgc3R5bGU9XCJjb2xvcjpyZWQ7IHBhZGRpbmctbGVmdDoyMHB4O1wiPiR7aHRtbChlcnJvcil9PC9wcmU+YCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaGVhZGVyLnNldEljb24oXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgYSBoZWFkZXIgd2l0aCBhbiBpY29uLCB0aXRsZSBhbmQgc291cmNlIG9mIHRoZSByZXF1ZXN0XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGFwcGVuZEhlYWRlcihpY29uOiBJY29uLCB0aXRsZTogc3RyaW5nLCBzb3VyY2U6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gKGBcclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlciAke2ljb24gPyBgaGVhZGVyLS0ke2ljb259YCA6IGBgfVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlcl9faWNvblwiPiR7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbiA/IGA8c3BhbiBjbGFzcz1cImljb25cIj48L3NwYW4+YCA6IGBgXHJcbiAgICAgICAgICAgICAgICB9PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyX190aXRsZVwiPiR7aHRtbCh0aXRsZSl9PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyX19zb3VyY2VcIj4ke2h0bWwoc291cmNlKX08L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+YFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgICRjb250ZW50LmFwcGVuZENoaWxkKGVsKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0SWNvbihpY29uOiBJY29uKSB7XHJcbiAgICAgICAgICAgIGVsLnF1ZXJ5U2VsZWN0b3IoXCIuaWNvblwiKSEuY2xhc3NOYW1lID0gYGljb24gaWNvbi0ke2ljb259YDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZXRJY29uKGljb24pO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXRJY29uXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgICAgICBcclxuICAgIC8qKlxyXG4gICAgICogRXNjYXBlIHBsYWluIHRleHQgYXMgSFRNTFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBodG1sKHN0cjogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIChzdHIgfHwgJycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLycvZywgJyYjMzk7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xyXG4gICAgfVxyXG4gICAgXHJcbn0pKHdpbmRvdyBhcyBQYW5lbFdpbmRvdyk7XHJcblxyXG4vKlxyXG5cclxuLy8gTk9URTogZG9uJ3QgbmVlZCB0aGlzIGZvciBub3cgLSBtaWdodCBuZWVkIGl0IHRvIGNvbW11bmljYXRlIHdpdGggXCJiYWNrZ3JvdW5kLmpzXCJcclxuXHJcbnBhbmVsX3dpbmRvdy5kb19zb21ldGhpbmcgPSAobXNnOiBzdHJpbmcpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKFwiRE9JTkcgU09NRVRISU5HXCIpO1xyXG4gICAgZG9jdW1lbnQuYm9keS50ZXh0Q29udGVudCArPSAnXFxuJyArIG1zZzsgLy8gU3R1cGlkIGV4YW1wbGUsIFBvQ1xyXG59XHJcblxyXG5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gTm8gbmVlZCB0byBjaGVjayBmb3IgdGhlIGV4aXN0ZW5jZSBvZiBgcmVzcG9uZGAsIGJlY2F1c2VcclxuICAgIC8vIHRoZSBwYW5lbCBjYW4gb25seSBiZSBjbGlja2VkIHdoZW4gaXQncyB2aXNpYmxlLi4uXHJcbiAgICBwYW5lbF93aW5kb3cucmVzcG9uZCgnQW5vdGhlciBzdHVwaWQgZXhhbXBsZSEnKTtcclxufTtcclxuKi9cclxuIl19