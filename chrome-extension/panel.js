import { renderLog } from "./log.js";
/**
 * This custom element allows us to isolate server-side log pages in a shadow-root.
 */
class LogEntry extends HTMLElement {
    constructor() {
        super();
        this.shadow = this.attachShadow({ mode: "open" });
    }
    setHTML(html) {
        let doc = new DOMParser().parseFromString(html, "text/html");
        this.style.display = "block";
        [...doc.head.querySelectorAll("style")].forEach(style => this.shadow.appendChild(style));
        [...doc.body.childNodes].forEach(node => this.shadow.appendChild(node));
    }
}
customElements.define("log-entry", LogEntry);
((panel) => {
    console.log("START: panel.js");
    const $content = document.body.querySelector("[data-content]");
    panel.onNavigation = url => {
        console.log("ON NAVIGATION", url);
        // TODO add "Preserve Log" option (similar to the "Network" tab)
        $content.innerHTML = "";
    };
    panel.onRequest = transaction => {
        console.log("ON REQUEST", transaction);
        // NOTE: weird typecasts required here because the request/response properties
        //       aren't defined in `@types/chrome` - we have to pull these definitions
        //       from a separate package `@types/har-format` and manually cast:
        const request = transaction.request;
        const response = transaction.response;
        const title = `${request.method} ${request.url} [${response.status} ${response.statusText}]`;
        for (let header of response.headers) {
            const name = header.name.toLowerCase();
            if (name === "x-chromelogger-data") {
                appendLog(title, "X-ChromeLogger-Data", new Promise(resolve => {
                    try {
                        const log = JSON.parse(atob(header.value));
                        console.log("PARSED CHROME-LOGGER HEADER", log);
                        resolve(renderLog(log));
                    }
                    catch (error) {
                        throw `Error parsing X-ChromeLogger-Data header (${error})`;
                    }
                }));
            }
        }
    };
    /**
     * Append a log document to the "Server Log" panel
     */
    function appendLog(title, source, documentPromise) {
        const header = appendHeader("spinner", title, source);
        const el = document.createElement("log-entry");
        $content.appendChild(el);
        documentPromise
            .then(html => {
            el.setHTML(html);
            header.setIcon("check");
        })
            .catch(error => {
            el.setHTML(`<pre style="color:red; padding-left:20px;">${html(error)}</pre>`);
            header.setIcon("error");
        });
    }
    /**
     * Create a header with an icon, title and source of the request
     */
    function appendHeader(icon, title, source) {
        const el = document.createElement("div");
        el.innerHTML = (`
            <div class="header ${icon ? `header--${icon}` : ``}">
                <div class="header__icon">${icon ? `<span class="icon"></span>` : ``}</div>
                <div class="header__title">${html(title)}</div>
                <div class="header__source">${html(source)}</div>
            </div>`);
        $content.appendChild(el);
        function setIcon(icon) {
            el.querySelector(".icon").className = `icon icon-${icon}`;
        }
        ;
        setIcon(icon);
        return {
            setIcon
        };
    }
    /**
     * Escape plain text as HTML
     */
    function html(str) {
        return (str || '')
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
    }
})(window);
/*

// NOTE: don't need this for now - might need it to communicate with "background.js"

panel_window.do_something = (msg: string) => {
    console.log("DOING SOMETHING");
    document.body.textContent += '\n' + msg; // Stupid example, PoC
}

document.documentElement.onclick = function() {
    // No need to check for the existence of `respond`, because
    // the panel can only be clicked when it's visible...
    panel_window.respond('Another stupid example!');
};
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcGFuZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBTyxNQUFNLFVBQVUsQ0FBQztBQUsxQzs7R0FFRztBQUNILE1BQU0sUUFBUyxTQUFRLFdBQVc7SUFHOUI7UUFDSSxLQUFLLEVBQUUsQ0FBQztRQUVSLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxPQUFPLENBQUMsSUFBWTtRQUNoQixJQUFJLEdBQUcsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFN0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRTdCLENBQUMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUMzQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFN0MsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUM1QixJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUNKO0FBRUQsY0FBYyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFFN0MsQ0FBQyxDQUFDLEtBQWtCLEVBQUUsRUFBRTtJQUVwQixPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFFL0IsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxh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QyxDQUFDLEVBQzFDOzZDQUM2QixJQUFJLENBQUMsS0FBSyxDQUFDOzhDQUNWLElBQUksQ0FBQyxNQUFNLENBQUM7bUJBQ3ZDLENBQ1YsQ0FBQztRQUVGLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFekIsU0FBUyxPQUFPLENBQUMsSUFBVTtZQUN2QixFQUFFLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBRSxDQUFDLFNBQVMsR0FBRyxhQUFhLElBQUksRUFBRSxDQUFDO1FBQy9ELENBQUM7UUFBQSxDQUFDO1FBRUYsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWQsT0FBTztZQUNILE9BQU87U0FDVixDQUFDO0lBQ04sQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUyxJQUFJLENBQUMsR0FBOEI7UUFDeEMsT0FBTyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUM7YUFDYixPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQzthQUN0QixPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQzthQUN2QixPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQzthQUN0QixPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQzthQUNyQixPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQy9CLENBQUM7QUFFTCxDQUFDLENBQUMsQ0FBQyxNQUFxQixDQUFDLENBQUM7QUFFMUI7Ozs7Ozs7Ozs7Ozs7O0VBY0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZW5kZXJMb2csIExvZyB9IGZyb20gXCIuL2xvZy5qc1wiO1xyXG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJoYXItZm9ybWF0XCI7XHJcblxyXG50eXBlIEljb24gPSBcInNwaW5uZXJcIiB8IFwiZXJyb3JcIiB8IFwiY2hlY2tcIiB8IHVuZGVmaW5lZDtcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGN1c3RvbSBlbGVtZW50IGFsbG93cyB1cyB0byBpc29sYXRlIHNlcnZlci1zaWRlIGxvZyBwYWdlcyBpbiBhIHNoYWRvdy1yb290LlxyXG4gKi9cclxuY2xhc3MgTG9nRW50cnkgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XHJcbiAgICBwcml2YXRlIHNoYWRvdzogU2hhZG93Um9vdDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICB0aGlzLnNoYWRvdyA9IHRoaXMuYXR0YWNoU2hhZG93KHsgbW9kZTogXCJvcGVuXCIgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0SFRNTChodG1sOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgZG9jID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhodG1sLCBcInRleHQvaHRtbFwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgICBbLi4uZG9jLmhlYWQucXVlcnlTZWxlY3RvckFsbChcInN0eWxlXCIpXS5mb3JFYWNoKFxyXG4gICAgICAgICAgICBzdHlsZSA9PiB0aGlzLnNoYWRvdy5hcHBlbmRDaGlsZChzdHlsZSkpO1xyXG5cclxuICAgICAgICBbLi4uZG9jLmJvZHkuY2hpbGROb2Rlc10uZm9yRWFjaChcclxuICAgICAgICAgICAgbm9kZSA9PiB0aGlzLnNoYWRvdy5hcHBlbmRDaGlsZChub2RlKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmN1c3RvbUVsZW1lbnRzLmRlZmluZShcImxvZy1lbnRyeVwiLCBMb2dFbnRyeSk7XHJcblxyXG4oKHBhbmVsOiBQYW5lbFdpbmRvdykgPT4ge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiU1RBUlQ6IHBhbmVsLmpzXCIpO1xyXG5cclxuICAgIGNvbnN0ICRjb250ZW50ID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PihcIltkYXRhLWNvbnRlbnRdXCIpITtcclxuXHJcbiAgICBwYW5lbC5vbk5hdmlnYXRpb24gPSB1cmwgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiT04gTkFWSUdBVElPTlwiLCB1cmwpO1xyXG5cclxuICAgICAgICAvLyBUT0RPIGFkZCBcIlByZXNlcnZlIExvZ1wiIG9wdGlvbiAoc2ltaWxhciB0byB0aGUgXCJOZXR3b3JrXCIgdGFiKVxyXG4gICAgICAgICRjb250ZW50LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhbmVsLm9uUmVxdWVzdCA9IHRyYW5zYWN0aW9uID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIk9OIFJFUVVFU1RcIiwgdHJhbnNhY3Rpb24pO1xyXG5cclxuICAgICAgICAvLyBOT1RFOiB3ZWlyZCB0eXBlY2FzdHMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIHRoZSByZXF1ZXN0L3Jlc3BvbnNlIHByb3BlcnRpZXNcclxuICAgICAgICAvLyAgICAgICBhcmVuJ3QgZGVmaW5lZCBpbiBgQHR5cGVzL2Nocm9tZWAgLSB3ZSBoYXZlIHRvIHB1bGwgdGhlc2UgZGVmaW5pdGlvbnNcclxuICAgICAgICAvLyAgICAgICBmcm9tIGEgc2VwYXJhdGUgcGFja2FnZSBgQHR5cGVzL2hhci1mb3JtYXRgIGFuZCBtYW51YWxseSBjYXN0OlxyXG5cclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gKHRyYW5zYWN0aW9uIGFzIGFueSkucmVxdWVzdCBhcyBSZXF1ZXN0O1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gKHRyYW5zYWN0aW9uIGFzIGFueSkucmVzcG9uc2UgYXMgUmVzcG9uc2U7XHJcblxyXG4gICAgICAgIGNvbnN0IHRpdGxlID0gYCR7cmVxdWVzdC5tZXRob2R9ICR7cmVxdWVzdC51cmx9IFske3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fV1gO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBoZWFkZXIgb2YgcmVzcG9uc2UuaGVhZGVycykge1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gaGVhZGVyLm5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChuYW1lID09PSBcIngtY2hyb21lbG9nZ2VyLWRhdGFcIikge1xyXG4gICAgICAgICAgICAgICAgYXBwZW5kTG9nKHRpdGxlLCBcIlgtQ2hyb21lTG9nZ2VyLURhdGFcIiwgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nID0gSlNPTi5wYXJzZShhdG9iKGhlYWRlci52YWx1ZSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQQVJTRUQgQ0hST01FLUxPR0dFUiBIRUFERVJcIiwgbG9nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVuZGVyTG9nKGxvZyBhcyBMb2cpKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBgRXJyb3IgcGFyc2luZyBYLUNocm9tZUxvZ2dlci1EYXRhIGhlYWRlciAoJHtlcnJvcn0pYDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBcHBlbmQgYSBsb2cgZG9jdW1lbnQgdG8gdGhlIFwiU2VydmVyIExvZ1wiIHBhbmVsXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGFwcGVuZExvZyh0aXRsZTogc3RyaW5nLCBzb3VyY2U6IHN0cmluZywgZG9jdW1lbnRQcm9taXNlOiBQcm9taXNlPHN0cmluZz4pIHtcclxuICAgICAgICBjb25zdCBoZWFkZXIgPSBhcHBlbmRIZWFkZXIoXCJzcGlubmVyXCIsIHRpdGxlLCBzb3VyY2UpO1xyXG5cclxuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsb2ctZW50cnlcIikgYXMgTG9nRW50cnk7XHJcblxyXG4gICAgICAgICRjb250ZW50LmFwcGVuZENoaWxkKGVsKTtcclxuXHJcbiAgICAgICAgZG9jdW1lbnRQcm9taXNlXHJcbiAgICAgICAgICAgIC50aGVuKGh0bWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgZWwuc2V0SFRNTChodG1sKTtcclxuXHJcbiAgICAgICAgICAgICAgICBoZWFkZXIuc2V0SWNvbihcImNoZWNrXCIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgZWwuc2V0SFRNTChgPHByZSBzdHlsZT1cImNvbG9yOnJlZDsgcGFkZGluZy1sZWZ0OjIwcHg7XCI+JHtodG1sKGVycm9yKX08L3ByZT5gKTtcclxuXHJcbiAgICAgICAgICAgICAgICBoZWFkZXIuc2V0SWNvbihcImVycm9yXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBhIGhlYWRlciB3aXRoIGFuIGljb24sIHRpdGxlIGFuZCBzb3VyY2Ugb2YgdGhlIHJlcXVlc3RcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gYXBwZW5kSGVhZGVyKGljb246IEljb24sIHRpdGxlOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG5cclxuICAgICAgICBlbC5pbm5lckhUTUwgPSAoYFxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyICR7aWNvbiA/IGBoZWFkZXItLSR7aWNvbn1gIDogYGB9XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyX19pY29uXCI+JHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uID8gYDxzcGFuIGNsYXNzPVwiaWNvblwiPjwvc3Bhbj5gIDogYGBcclxuICAgICAgICAgICAgICAgIH08L2Rpdj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJfX3RpdGxlXCI+JHtodG1sKHRpdGxlKX08L2Rpdj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJfX3NvdXJjZVwiPiR7aHRtbChzb3VyY2UpfTwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5gXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgJGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWwpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRJY29uKGljb246IEljb24pIHtcclxuICAgICAgICAgICAgZWwucXVlcnlTZWxlY3RvcihcIi5pY29uXCIpIS5jbGFzc05hbWUgPSBgaWNvbiBpY29uLSR7aWNvbn1gO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNldEljb24oaWNvbik7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNldEljb25cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBFc2NhcGUgcGxhaW4gdGV4dCBhcyBIVE1MXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGh0bWwoc3RyOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gKHN0ciB8fCAnJylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JylcclxuICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csICcmcXVvdDsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvJy9nLCAnJiMzOTsnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7Jyk7XHJcbiAgICB9XHJcbiAgICBcclxufSkod2luZG93IGFzIFBhbmVsV2luZG93KTtcclxuXHJcbi8qXHJcblxyXG4vLyBOT1RFOiBkb24ndCBuZWVkIHRoaXMgZm9yIG5vdyAtIG1pZ2h0IG5lZWQgaXQgdG8gY29tbXVuaWNhdGUgd2l0aCBcImJhY2tncm91bmQuanNcIlxyXG5cclxucGFuZWxfd2luZG93LmRvX3NvbWV0aGluZyA9IChtc2c6IHN0cmluZykgPT4ge1xyXG4gICAgY29uc29sZS5sb2coXCJET0lORyBTT01FVEhJTkdcIik7XHJcbiAgICBkb2N1bWVudC5ib2R5LnRleHRDb250ZW50ICs9ICdcXG4nICsgbXNnOyAvLyBTdHVwaWQgZXhhbXBsZSwgUG9DXHJcbn1cclxuXHJcbmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBObyBuZWVkIHRvIGNoZWNrIGZvciB0aGUgZXhpc3RlbmNlIG9mIGByZXNwb25kYCwgYmVjYXVzZVxyXG4gICAgLy8gdGhlIHBhbmVsIGNhbiBvbmx5IGJlIGNsaWNrZWQgd2hlbiBpdCdzIHZpc2libGUuLi5cclxuICAgIHBhbmVsX3dpbmRvdy5yZXNwb25kKCdBbm90aGVyIHN0dXBpZCBleGFtcGxlIScpO1xyXG59O1xyXG4qL1xyXG4iXX0=